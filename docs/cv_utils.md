# Модуль [`cv_utils.py`](../cv_utils.py "Перейти к модулю")

Содержит утилиты для работы с изображениями, видео и визуализацией данных.
Основные возможности включают работу с масками (класс `Mask`), ограничивающими
прямоугольниками (класс `BBox`), а также функции для анализа и фильтрации
объектов.

---

## Основные возможности

### Ключевые компоненты

- **Класс `Mask`** - работа с бинарными и полутоновыми масками изображений;
- **Класс `BBox`** - работа с ограничивающими прямоугольниками;
- **Метрики сравнения** - IoU (Intersection over Union), Dice, Overlap;
- **NMS (Non-maximum Suppression)** - фильтрация дублирующихся обнаружений;
- **Визуализация** - отрисовка масок и прямоугольников на изображениях;
- **Работа с видео** - конвертация видео в GIF, обработка кадров.

---

## Основные классы

### Класс `Mask`

Работа с бинарными и полутоновыми масками сегментов.

#### Основные методы класса Mask

<!-- markdownlint-disable MD013 -->
| Метод                                         | Назначение                               |
|-----------------------------------------------|------------------------------------------|
| `to_image()`                                  | конвертация маски в заданный тип данных  |
| `morphology()`                                | морфологические операции                 |
| `rectangle()`                                 | получение ограничивающего прямоугольника |
| `area()`                                      | вычисление площади маски                 |
| `IoU_with()`, `Dice_with()`, `Overlap_with()` | метрики сравнения                        |
| `draw()`, `show()`                            | визуализация маски                       |
<!-- markdownlint-enable MD013 -->

#### Особенности класса Mask

- Поддерживает типы данных: bool, uint8, float;
- Реализует операторы для морфологических операций;
- Автоматическое кэширование вычисляемых параметров.

### Класс `BBox`

Работа с ограничивающими прямоугольниками.

#### Основные методы класса BBox

| Метод                                         | Назначение                     |
|-----------------------------------------------|--------------------------------|
| `from_format()`                               | создание из различных форматов |
| `from_yolo()`                                 | создание из YOLO-формата       |
| `area()`                                      | вычисление площади             |
| `IoU_with()`, `Dice_with()`, `Overlap_with()` | метрики сравнения              |
| `draw()`, `show()`                            | визуализация прямоугольника    |

#### Особенности класса BBox

- Поддержка относительных и абсолютных координат;
- Операции пересечения (`&`) и объединения (`|`) прямоугольников;
- Совместимость с форматами CVAT и YOLO.

---

## Вспомогательные классы

### Класс `NMS` (Non-maximum Suppression)

Фильтрация дублирующихся обнаружений по порогу IoU.

```python
nms = NMS(minIoU=0.5)
filtered_objects = nms(objects_list)
```

### Класс `PrintInfo`

Декоратор для отслеживания времени обработки и статистики списков.

```python
@PrintInfo(name="Фильтр")
def filter_objects(objects):
    # обработка
    return filtered_objects
```

---

## Основные функции

| Функция                              | Назначение                                  |
|--------------------------------------|---------------------------------------------|
| `build_IoU_matrix()`                 | построение матрицы IoU для списка объектов  |
| `build_JaccardDiceOverlap_matrixs()` | построение матриц метрик                    |
| `split_by_attrib()`                  | группировка объектов по значению атрибута   |
| `sort_by_attrib()`                   | сортировка объектов по атрибуту             |
| `video2gif()`                        | конвертация последовательности кадров в GIF |

---

## Примеры использования

### Сравнение масок

```python
mask1 = Mask(array1)
mask2 = Mask(array2)
iou = mask1.IoU_with(mask2)
dice = mask1.Dice_with(mask2)
```

### Фильтрация дубликатов с помощью NMS

```python
# objects - список BBox или Mask с атрибутом 'confidence'
nms = NMS(minIoU=0.7)
filtered = nms(objects)
```

### Визуализация

```python
# Отрисовка маски на изображении
result = mask.draw(image, color=(0, 255, 0), alpha=0.5)

# Отрисовка прямоугольника
result = bbox.draw(image, color=(255, 0, 0), thickness=2)
```

### Построение матрицы IoU

```python
masks = [Mask(m) for m in masks_list]
iou_matrix = build_IoU_matrix(masks)
```

---

## Примечания

- Все операции с масками и прямоугольниками поддерживают параллельную обработку;
- Классы `Mask` и `BBox` совместимы с форматами COCO, CVAT и YOLO;
- Визуализация поддерживает прозрачность и различные цветовые схемы;
- NMS работает как с масками, так и с прямоугольниками.

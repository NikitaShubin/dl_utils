# Модуль `pt_utils.py`

## Общее описание
Модуль содержит набор вспомогательных инструментов для работы с фреймворком PyTorch, включая автоматическое управление вычислительными устройствами, обработку данных и специализированные слои нейронных сетей. Основной фокус сделан на задачах сегментации изображений.

## Основные компоненты

### 1. Управление вычислительными устройствами

#### `AutoDevice`
Класс для автоматического выбора и настройки вычислительного устройства:
- **get_avliable_device()** - определяет оптимальное устройство (CUDA GPU → MPS → CPU)
- **prepare_device()** - настраивает параметры работы для выбранного устройства:
  - Включает autocast для CUDA
  - Активирует TF32 для GPU архитектуры Ampere
- Поддерживает все основные платформы (NVIDIA, Apple M1/M2, CPU)

### 2. Обработка данных

#### `SegDataset`
Класс Dataset для задач сегментации изображений:
- Автоматически парсит структуру папок (входные/выходные изображения)
- Поддерживает albumentations-совместимые аугментации
- Реализует One-Hot Encoding для масок сегментации
- Проверяет соответствие имен файлов входов и выходов

### 3. Специализированные слои нейронных сетей

#### `Sender`
Транспонированная свертка для увеличения пространственного разрешения:
- Увеличивает размер карты признаков в kernel_size раз
- Сохраняет число каналов (in_channels → out_channels)
- Автоматически настраивает параметры stride и kernel_size

#### `Receiver`
Сверточный слой для обработки сообщений:
- Восстанавливает исходное пространственное разрешение
- Компенсирует эффекты увеличения от Sender
- Автоматически рассчитывает padding и dilation
- Поддерживает прямоугольные ядра свертки

### 4. Валидация архитектур

Модуль включает встроенные проверки корректности работы слоев Sender/Receiver:
- Тестирование на различных размерах ядер (от 2 до 20)
- Проверка сохранения пространственных размеров
- Валидация соответствия входных/выходных размерностей
- Тестирование на случайных размерах карт признаков

## Зависимости
- PyTorch (основная зависимость)
- OpenCV (загрузка изображений)
- NumPy (работа с массивами)
- tqdm (индикатор прогресса)
- Встроенные проверки не требуют дополнительных зависимостей

Модуль предназначен для упрощения разработки нейросетевых моделей на PyTorch, особенно в задачах компьютерного зрения и сегментации изображений.

# Модуль `copybal.py`

Модуль реализует алгоритм копирующей балансировки датасета для задач компьютерного зрения. Основная цель - выравнивание распределения классов объектов в датасете путем контролируемого дублирования изображений с сохранением контекста.

## Основные компоненты

### 1. Вспомогательные функции
#### Идентификация объектов:
- `build_unigue_track_id()` - создание уникального идентификатора объекта:
  - Объединяет информацию о файле, задаче, подзадаче, треке и метке
  - Использует специальный разделитель (sep_char)

- `split_unigue_track_id()` - обратная операция разбора идентификатора

#### Работа с графами связностей:
- `init_object_file_graph_by_task()` - инициализация графа для одной задачи:
  - Создает структуру для хранения связей объектов и файлов
  - Учитывает только используемые классы (labels_convertor(label) >= 0)

- `init_task_object_file_graphs()` - массовая инициализация графов для всех задач
- `update_object_file_graphs()` - обновление графов новыми связями
- `drop_unused_track_ids_in_graphs()` - очистка графов от неиспользуемых объектов

### 2. Основная функция балансировки
#### `make_copy_bal()`:
- Координирует весь процесс балансировки
- Выполняет:
  1. Подготовку путей и структур данных
  2. Парсинг графов связностей
  3. Оптимизацию числа копий через `torch_copy_bal`
  4. Создание дубликатов файлов

#### `torch_copy_bal()`:
- Реализует итеративный процесс оптимизации с использованием PyTorch
- Учитывает 4 компонента функции потерь:
  1. `files_counter_loss` - дисперсия числа копий файлов
  2. `object_loss` - дисперсия появления объектов
  3. `class_loss` - дисперсия распределения классов
  4. `superclass_loss` - дисперсия распределения суперклассов

# Модуль [`ul_utils.py`](../ul_utils.py "Перейти к модулю")

Содержит обёртки для работы с моделями библиотеки Ultralytics (YOLO, RT-DETR и др.),
обеспечивающие удобный инференс и преобразование результатов в различные форматы.

Основной фокус сделан на задачах детекции, сегментации и трекинга объектов
с поддержкой различных режимов вывода.

---

## Основные компоненты

### Классы

| Класс              | Описание                        |
|--------------------|---------------------------------|
| `UltralyticsModel` | обёртка для моделей Ultralytics |

---

## Описание классов

### Класс `UltralyticsModel`

Универсальная обёртка для моделей Ultralytics с поддержкой различных режимов работы.

#### Конструктор

```python
UltralyticsModel(
    model: str | YOLO = 'rtdetr-x.pt',
    tracker = None,
    mode: str = 'preannotation',
    postprocess_filters: list = [],
    *args, **kwargs
)
```

#### Параметры

- `model` - путь к файлу модели или объект YOLO;
- `tracker` - конфигурация трекера для отслеживания объектов;
- `mode` - режим работы:
  - `'preannotation'` - вывод в формате DataFrame для CVAT;
  - `'preview'` - визуализация результатов на изображении;
- `postprocess_filters` - список фильтров для постобработки результатов.

#### Основные методы

| Метод        | Назначение                                                   |
|--------------|--------------------------------------------------------------|
| `img2df()`   | обработка изображения и возврат результатов в виде DataFrame |
| `draw()`     | визуализация результатов на изображении                      |
| `reset()`    | сброс состояния трекеров и фильтров                          |
| `__call__()` | универсальный вызов в зависимости от режима                  |

#### Особенности

- автоматическая загрузка моделей в папку `~/models/` при необходимости;
- поддержка масок, bounding boxes и потенциально других типов предсказаний;
- совместимость с трекерами для multi-object tracking;
- система фильтров для постобработки обнаруженных объектов.

---

## Примеры использования

### Режим предварительной аннотации

```python
model = UltralyticsModel('yolov8n.pt', mode='preannotation')
df = model(img)  # возвращает DataFrame для импорта в CVAT
```

### Режим визуализации

```python
model = UltralyticsModel('yolov8n-seg.pt', mode='preview')
result_img = model(img)  # возвращает изображение с разметкой
```

### С трекером

```python
model = UltralyticsModel('yolov8n.pt', tracker='bytetrack.yaml', mode='preannotation')
```

---

## Примечания

- Для масок автоматически применяется масштабирование к исходному размеру изображения;
- Поддерживается сброс состояния трекеров через метод `reset()`;
- Модели автоматически загружаются в оптимальное устройство (GPU/CPU);
- Формат вывода совместим с инструментами разметки CVAT.

# Модуль [`classes.py`](https://github.com/NikitaShubin/dl_utils/blob/main/classes.py "Перейти к модулю")

Предоставляет функционалность для работы с метками классов и суперклассов, хранящимися в Excel-файлах. Основное назначение - конвертация между различными системами обозначений классов и организация иерархических связей между ними.

---

## Основные компоненты

### Вспомогательные функции

#### Чтение данных
| Функция                  | Назначение                                                                                                                                                                                    |
|--------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `read_classes2df()`      | загрузка и предобработка файла с классами: <br/> - удаление пустых столбцов;<br/> - очистка строковых значений; <br/> - установка первого столбца как индекса; <br/> - удаление пустых строк. |
| `read_superclasses2df()` | загрузка файла с суперклассами: <br/> - заполнение пропущенных значений; <br/> - нормализация номеров суперклассов; <br/> - проверка целостности данных.                                      |

#### Обработка данных
| Функция          | Назначение                                                                                                                                                            |
|------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `classes2tree()` | построение иерархического дерева классов: <br/> - поддержка римских и арабских номеров; <br/> - разделение на группы и подклассы; <br/> - хранение меток CVAT и UUID. |
| `fix_string()`   | унификация строковых значений: <br/> - замена специальных пробелов; <br/> - удаление лишних пробелов.                                                                 |

### Функции создания словарей
| Функция                                   | Назначение                                                                                                                                                                   |
|-------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `make_label2class_meaning_dicts()`        | создание словарей перевода меток:<br/> -`cvat_label2class_meaning` - для меток CVAT; <br/> -`gg_uuid2class_meaning` - для UUID меток; <br/> - проверка на уникальность меток. |
| `make_yolo_label2superclass_meaning()`    | словарь номеров YOLO                                                                                                                                                         |
| `make_class_meaning2superclass_meaning()` | словарь классов                                                                                                                                                              |

### Класс LabelsConvertor
Основной класс для работы с метками классов и суперклассов.

#### Инициализация:
- автоматический поиск файлов классов;
- загрузка и предобработка данных;
- построение всех необходимых словарей;
- инициализация счетчиков классов.

#### Основные методы
| Метод                 | Назначение                                  |
|-----------------------|---------------------------------------------|
| `any_label2meaning()` | конвертация любой метки в читаемое название |
| `__call__()`          | конвертация метки в номер суперкласса       |
| `apply2df()`          | применение конвертации к DataFrame          |
| `init_df_counter()`   | создание счетчиков классов                  |

#### Хранимые данные:
- иерархия классов (tree);
- множество словарей для конвертации;
- списки уникальных значений;
- счетчики встречаемости.

### Дополнительные функции
| Функция                          | Назначение                   |
|----------------------------------|------------------------------|
| `checkout_labels_in_tasks()`     | поиск неподдерживаемых меток |
| `apply_labels_convertor2tasks()` | пакетная конвертация меток   |

---

## Форматы данных:
- **входные данные**: excel-файлы с жестко заданной структурой;
- **выходные данные**: 
  - словари конвертации;
  - DataFrame с метаинформацией;
  - иерархические структуры.

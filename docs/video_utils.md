# Модуль `video_utils.py`

## Общее описание
Модуль `video_utils.py` предоставляет комплексные утилиты для работы с видео и изображениями, включая:
- Обработку и конвертацию видеофайлов
- Работу с оптическим потоком
- Создание конвейеров обработки изображений
- Генерацию и обработку видеопоследовательностей
- Визуализацию семантической сегментации

Основные зависимости:
- OpenCV (`cv2`) для обработки видео и изображений
- NumPy (`np`) для работы с массивами
- SciPy (`scipy`) для интерполяции и обработки сеток
- Вспомогательные модули (`utils`, `skimage`, `matplotlib`)

## Основные компоненты

### Обработка видеофайлов
1. **`recomp2mp4`**:
   - Пересжимает видео в формат MP4 с использованием кодека H.264
   - Поддерживает удаление исходного файла после конвертации

2. **`convert_videos`**:
   - Пакетная конвертация видеофайлов в директории
   - Автоматическое создание структуры поддиректорий

### Конвейерная обработка (Pipeline)
- **Класс `Pipeline`**:
  - Гибкая система фильтров для обработки изображений/видео
  - Поддержка цепочек преобразований
  - Автоматическая обработка цветовых пространств
  - Возможность сохранения результатов обработки

### Работа с видеопотоками
1. **`ViRead`**:
   - Чтение видеофайлов с поддержкой различных цветовых пространств
   - Гибкое управление диапазонами кадров
   - Режимы обработки конца потока (сброс, закрытие, повтор)

2. **`ViSave`**:
   - Запись видеофайлов с настройкой параметров
   - Автоматическое создание директорий
   - Поддержка различных цветовых пространств

3. **`VideoGenerator`**:
   - Унифицированный интерфейс для работы с последовательностями кадров
   - Поддержка смешанных источников (видео + изображения)
   - Гибкое управление диапазонами кадров

### Оптический поток
- **Класс `OptFlow`**:
  - Обёртка вокруг `cv2.calcOpticalFlowFarneback`
  - Методы для:
    - Расчёта потоков между кадрами
    - Визуализации потоков
    - Деформации изображений по потокам
    - Восстановления последовательностей

### Специальные фильтры обработки
1. **`DrawSemanticSegments`**:
   - Визуализация результатов семантической сегментации
   - Поддержка бинарной и многоклассовой сегментации
   - Цветовое кодирование классов

2. **`StoreLastFrames`**:
   - Буферизация предыдущих кадров
   - Полезно для временных последовательностей

3. **`StreamRandomCrop/Flip`**:
   - Аугментация видеопоследовательностей
   - Согласованная обработка кадров в последовательности

### Вспомогательные утилиты
- Преобразования цветовых пространств (RGB/BGR/YUV/Gray)
- Изменение размеров изображений (`Resize`, `ResizeAndRestore`)
- Наложение текста и временных меток (`AddCaption`, `PutTime`)
- Комбинирование изображений (`Mix`, `Concat`, `Compare*`)
- Работа с файловой системой (`get_file_list`)

## Особенности обработки
- Поддержка аппаратного ускорения через OpenCV
- Эффективное управление памятью при работе с большими видеофайлами
- Гибкая система обработки ошибок и исключений
- Интеграция с Albumentations для аугментации
- Поддержка многопоточной обработки через `mpmap`

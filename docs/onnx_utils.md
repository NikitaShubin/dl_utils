# Модуль `onnx_utils.py`

## Общее описание
Модуль предоставляет инструменты для работы с моделями в формате ONNX (Open Neural Network Exchange), включая конвертацию из Keras, квантование и выполнение инференса. Основные функции ориентированы на задачи оптимизации нейросетевых моделей для production-сред.

## Основные компоненты

### 1. Конвертация моделей

#### `keras2onnx()`
Преобразует Keras-модель в несколько вариантов ONNX-представления:
- Полноценная версия в float32
- Оптимизированная версия в float16
- Динамически квантованная версия в uint8 
- Статически квантованная версия в int8 (требует калибровочного датасета)

#### Особенности:
- Использует tf2onnx для первичной конвертации
- Применяет onnxmltools для оптимизации в float16
- Поддерживает как статическое, так и динамическое квантование
- Автоматически удаляет временные файлы

### 2. Работа с весами моделей

#### `get_weights()`
Извлекает веса из ONNX-модели:
- Возвращает список numpy-массивов
- Сохраняет исходную структуру весов
- Работает с форматом initializer графа ONNX

### 3. Калибровка данных

#### `DataReader`
Адаптер для преобразования генераторов данных в формат, пригодный для калибровки:
- Определяет имя входного тензора автоматически
- Поддерживает итерацию по датасету
- Преобразует данные в numpy-массивы
- Интегрируется с ONNX Runtime Quantization

### 4. Выполнение инференса

#### `ONNXModel`
Обёртка для удобной работы с ONNX-моделями:
- Автоматически определяет формат входных данных (channel-first/channel-last)
- Поддерживает выполнение на GPU и CPU
- Обрабатывает преобразование форматов тензоров
- Предоставляет единый интерфейс для вызова модели

#### Особенности:
- Автоматическое определение типа входных данных
- Поддержка float16 и float32
- Преобразование между CHW и HWC форматами
- Пакетная обработка с добавлением batch-измерения

## Зависимости
- ONNX (базовая библиотека)
- ONNX Runtime (для выполнения моделей)
- tf2onnx (для конвертации из Keras/TensorFlow)
- onnxmltools (для оптимизации моделей)
- NumPy (работа с массивами)
- tqdm (индикатор прогресса)
- Вспомогательные модули: `utils.py`, `ml_utils.py`

Модуль предназначен для конвертации, оптимизации и выполнения нейросетевых моделей в production-средах с поддержкой различных аппаратных ускорителей.

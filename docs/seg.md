# Модуль `seg.py`

## Общее описание
Модуль `seg.py` предназначен для работы с датасетами семантической сегментации. Он предоставляет функционал для:
- Конвертации задач из формата CVAT в датасет сегментации
- Создания цветных превью для визуализации масок
- Фильтрации однородных (неразмеченных) кадров
- Генерации видео-превью из набора изображений

Основные функции модуля используют библиотеки OpenCV (`cv2`), NumPy и дополнительные утилиты из локального модуля `utils`.

## Основные функции

### `save_task2segmentation_dataset`
- **Назначение**: Сохраняет отдельную задачу (task) в виде набора файлов для датасета сегментации.
- **Ключевые особенности**:
  - Поддерживает фильтрацию кадров с исключёнными классами (метка `-2`).
  - Генерирует три типа файлов: исходные изображения (`inp`), маски (`out`) и превью (`prv`).
  - Для превью использует цветовую кодировку: зелёный для обычных объектов, красный для исключённых, синий для неиспользуемых.
  - Сохраняет метаинформацию (название проекта, задачи и номер кадра) на превью.

### `save_tasks2segmentation_dataset`
- **Назначение**: Обрабатывает список задач и сохраняет их в структурированный датасет.
- **Ключевые особенности**:
  - Автоматически создаёт папки `inp`, `out` и (опционально) `prv`.
  - Сортирует задачи по количеству кадров для оптимальной обработки.
  - Поддерживает параллельную обработку через `mpmap`.

### Функции для работы с превью
1. **`draw_seg_prev`**:
   - Создаёт цветное превью, накладывая маску сегментации на исходное изображение.
   - Использует HSV-цветовое пространство для кодировки классов.

2. **`make_seg_subset_colored_preview`**:
   - Генерирует превью для подвыборки датасета (train/val/test).
   - Поддерживает создание видео из набора превью.

3. **`make_seg_dataset_colored_preview`**:
   - Организует обработку всех подвыборок датасета (train, val, test).

### `drop_homogeneous_labeled_frames`
- **Назначение**: Фильтрует кадры, где все пиксели принадлежат одному классу (неразмеченные).
- **Ключевые особенности**:
  - Работает со всеми подвыборками датасета.
  - Удаляет соответствующие файлы изображений, масок и превью.
  - Подсчитывает и выводит количество удалённых семплов.

## Вспомогательные компоненты
- **Цветовая кодировка**:
  - Классы кодируются оттенками в HSV (от 0 до 180°).
  - Насыщенность всегда максимальна (255).
  
- **Обработка исключений**:
  - Кадры с меткой `-2` полностью исключаются из датасета.
  - Кадры с меткой `-1` отмечаются на превью, но сохраняются в датасете.

- **Параллельная обработка**:
  - Используется функция `mpmap` для ускорения обработки больших наборов данных.

## Зависимости
- Основные: `os`, `cv2`, `numpy`, `tqdm`
- Локальные: `utils`, `cvat` (для работы с CVAT-разметкой)

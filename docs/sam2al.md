# Модуль [`sam2al.py`](https://github.com/NikitaShubin/dl_utils/blob/main/sam2al.py "Перейти к модулю")

Предоставляет инструменты для работы с Segment Anything Model 2 (SAM2) и интеграции с системой интерактивной сегментации. 
Основные функции - обработка видео, управление подсказками для сегментации и экспорт результатов в CVAT.

---

## Основные возможности

### Ключевые функции:
- интеграция с SAM2 для видео-сегментации;
- управление подсказками (точки, маски, прямоугольники);
- трекинг объектов в прямом и обратном направлении времени;
- генерация превью с визуализацией масок;
- экспорт разметки в формате CVAT XML.

---

## Основные компоненты

### Классы

| Класс     | Описание                                                      |
|-----------|---------------------------------------------------------------|
| `Prompts` | управление подсказками (точки, маски, метки) для сегментации  |
| `SAM2`    | обёртка для SAM2: загрузка видео, трекинг, генерация разметки |

---

## Описание классов

### Класс `Prompts`
Управляет хранением и обработкой подсказок для сегментации в формате CVAT-датафрейма.

#### Методы:
| Метод          | Назначение                                                |
|----------------|-----------------------------------------------------------|
| `set_points()` | добавление новых подсказок (маски, точки, прямоугольники) |
| `get_points()` | извлечение подсказок для конкретного кадра и объекта      |
| `clear()`      | очистка подсказок по кадрам или объектам                  |
| `hash()`       | генерация хеша для проверки изменений                     |

#### Параметры инициализации:
- `seq_len`: длина видео-последовательности;
- `imsize`: размер кадра;
- `file`: путь к TSV-файлу для сохранения подсказок.

---

### Класс `SAM2`
Интеграция SAM2 для видео-сегментации с поддержкой интерактивных подсказок.

#### Методы:
| Метод                | Назначение                                          |
|----------------------|-----------------------------------------------------|
| `load_video()`       | загрузка видео и инициализация временных файлов     |
| `build_subtask()`    | генерация разметки для CVAT с учётом подсказок      |
| `render_preview()`   | создание видео-превью с визуализацией масок         |
| `save2cvat_xml()`    | экспорт разметки в XML-формат CVAT                  |
| `init_ipis_kwargs()` | подготовка параметров для интерактивной сегментации |

#### Параметры инициализации:
- `model_path`: путь к весам SAM2;
- `config`: конфигурационный файл модели;
- `device`: вычислительное устройство (`auto` для автоматического выбора).
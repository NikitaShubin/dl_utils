# Модуль `sam2al.py`

Модуль предоставляет инструменты для работы с Segment Anything Model 2 (SAM2) и интеграции с системой интерактивной сегментации. 
Основные функции - обработка видео, управление подсказками для сегментации и экспорт результатов в CVAT.

## Основные компоненты

### 1. Управление подсказками (Prompts)

#### Класс `Prompts`
Организует хранение и обработку подсказок для сегментации:
- Хранит данные в CVAT-совместимом формате
- Поддерживает различные типы подсказок: точки, прямоугольники, маски
- Обеспечивает автоматическое сохранение в TSV-файл
- Реализует методы для:
  - Добавления/удаления подсказок
  - Фильтрации по кадрам и объектам
  - Преобразования между форматами данных
  - Генерации хешей для проверки изменений

### 2. Работа с SAM2

#### Класс `SAM2`
Обёртка для работы с Segment Anything Model 2:
- **Инициализация модели**:
  - Автоматический выбор конфигурации
  - Поддержка различных устройств (CUDA, MPS, CPU)
  - Управление временными файлами

- **Обработка видео**:
  - Загрузка и подготовка видеофайлов
  - Извлечение кадров в промежуточный формат
  - Управление состоянием трекера

- **Методы сегментации**:
  - Преобразование подсказок в формат SAM2
  - Прямой и обратный проходы по видео
  - Генерация масок и их векторизация

### 3. Интеграция с CVAT

#### Функции экспорта:
- Генерация XML-файлов разметки
- Создание и обновление задач в CVAT
- Поддержка различных форматов экспорта:
  - "Чистые" контуры (с подгонкой)
  - "Черновые" маски (без обработки)

#### Визуализация:
- Генерация preview-видео с разметкой
- Цветовое кодирование объектов
- Поддержка различных режимов отображения

### 4. Вспомогательные функции

#### Преобразование данных:
- Конвертация между форматами масок и точек
- Поддержка различных пространственных расположений каналов
- Обработка исключительных ситуаций

#### Управление состоянием:
- Контроль текущего кадра и объекта
- Работа с метками классов
- Сброс и восстановление состояния трекера